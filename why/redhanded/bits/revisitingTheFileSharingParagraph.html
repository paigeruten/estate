<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0105)redhanded.hobix.com/bits/revisitingTheFileSharingParagraph.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/bits/revisitingTheFileSharingParagraph.html">--><BASE href=".">


<TITLE>RedHanded » Revisiting the File-Sharing Paragraph</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Revisiting the File-Sharing Paragraph
  <SPAN class="entryPermalink"><A href="../bits/revisitingTheFileSharingParagraph.html" title="Permanent link to &ldquo;Revisiting the File-Sharing Paragraph&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../bits" title="List of entries in the &ldquo;bits&rdquo; category">bits</A>
</DIV>

     <DIV class="entryContent"><P>RedHanded is just over a year old, designed as an exercise to help me flesh out some better code examples and to horse around with dodgy Ruby ideas that perhaps weren’t destined to be full projects.  At the time, in December of last year, <A href="http://flgr.0x42.net/">Florian Gross</A> and <A href="http://eigenclass.org/">Mauricio Fernandez</A> had been golfing with a number of tantalizing scripts like <A href="../bits/aFileSharingParagraph.html">flgr’s 6-line p2p</A> and <A href="../bits/batsmansFiveLineWiki.html">batsman’s 5-line wiki</A>.</P>


	<P>For a while, I ran flgr’s file-sharing app to distribute songs from a Ruby mixtape (<A href="../cult/theRubyMixTapeDayOne.html">day 1</A>, <A href="../cult/theRubyMixTapeDayTwo.html">day 2</A>, <A href="../cult/theRubyMixTapeDayThree.html">day 3</A>.)  Sadly, the little server didn’t really have concurrency.  The project got <A href="../cult/mixTapeSuspended.html">pocketed</A>.</P>


	<P>Lately, I’ve been playing with a rewrite of miniature file-sharing and I really like what’s come out:</P>


<PRE> #!/usr/bin/ruby -s -rsocket
 # Servers:
 #   ruby p2p.rb -L=localhost:2005 -R=localhost:2005 -W=foobar
 #   ruby p2p.rb -L=localhost:2006 -R=localhost:2005 -W=foobar
 #
 # Client:
 #   ruby ~/bin/p2p.rb -R=localhost:2005 -W=foobar -S=*.rb
 #
 def s(h,t);h[/:/];[TCPSocket,TCPServer][t].new($`,$');end;def n(h,a,*r,&amp;b);c=
 s(h,0);c.puts(([$W,a]+r)*'|');(b)?(while l=c.read(1024);b.call l;end):c.read.
 split("\n");end;def f(k,a,r);k.map{|_|n(_,a,r)};end;def o(x);x[/\/?(.*)/, 1].
 gsub(/\.{2,}/){};end;$L?(k=[$L];k+=n($R,:d,$L)if$L!=$R;k.uniq!;s=s($L,1);while
 i=s.accept;Thread.new(k,i){|k,c|w,a,r=c.gets.strip.split'|';c.puts(begin;case a
 when 's':f(k,:l,r);when 'g':IO.read o(r);when 'a':k&lt;&lt;r;k.uniq!;k;when 'd':f(k,
 :a,r);k;when 'l':Dir[o(r)].map{|_|"#$L "+_};end;rescue;end||"\n") if w==$W;c.
 close};end):($R?(n($R,:s,$S).each{|f|h,f=f.split' ';open(f,'w'){|o|n(h,:g,f){
 |l|o&lt;&lt;l}}}):0)
</PRE>

	<P>This little client/server is patterned after <A href="http://www.crossflux.org/uP2P/">uP2P</A>.  It shares everything under the working directory.  And, if you can spot the <CODE>case</CODE> statement, there are five commands.  If you run a single server and telnet into it, you can try these out:</P>


	<UL>
	<LI><CODE>s</CODE> recursively searches for a glob. <CODE>s|foobar|*.rb</CODE></LI>
		<LI><CODE>g</CODE> reads a file’s contents. <CODE>g|foobar|p2p.rb</CODE></LI>
		<LI><CODE>a</CODE> announces your peer. <CODE>a|foobar|192.168.0.5:2006</CODE></LI>
		<LI><CODE>d</CODE> lists the peer directory. <CODE>d|foobar|192.168.0.5:2006</CODE>.</LI>
		<LI><CODE>l</CODE> lists the files for the connected peer only. <CODE>l|foobar|*.rb</CODE></LI>
	</UL>


	<P>The client mode just downloads from all peers anything matching the glob.  I probably need to do some exception handling at some point.  This will stream IO, though!</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>12:07</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    10 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>14:05</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Cool.  Any more Ruby mixtapery?  That was keen.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>flgr</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>15:26</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Hmmm, is this a challenge for further golfing? :)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>15:40</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>flgr</STRONG>: Sure, I’d like to see it go sub-500 bytes.  <A href="http://ansuz.sooke.bc.ca/software/molester/">Like these.</A></P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>&lt;|:{</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>18:20</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Why keep this a golfing script?  Might it not be more useful if you go ahead and add the line breaks needed to make it readable (and thus more easily modifyable)?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>erik</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 Jan 2006</NOBR> at <NOBR>19:00</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>This looks like a great obfuscated Ruby entry (perhaps a valid tragically misintentioned subproject?) but like a horrible coding example.  What’s the goal here? To minimize the number of  ASCII  lines? Every ; essentially counts as a newline to the parser so i don’t see the point here. This is almost as unreadable as the line noise they call perl. We aren’t trying to emulate that are we? Ooh, look at me, I detest <I>newlines</I>.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Jan 2006</NOBR> at <NOBR>00:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>It’s just more compact like this.  Fits into view.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Jan 2006</NOBR> at <NOBR>10:11</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>erik</STRONG>: Our goal here, I think, isn’t <EM>great code</EM>, but rather <EM>interesting code</EM>.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>THBMan</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Jan 2006</NOBR> at <NOBR>10:36</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>And this is interesting without a doubt.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>erik</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Jan 2006</NOBR> at <NOBR>10:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I agree, I love this site because it has interesting code, and a small p2p app in ruby <I>is</I> interesting. I’m only attempting to deriding the notion that it has to be unreadable.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>flgr</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Jan 2006</NOBR> at <NOBR>14:41</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>erik: Making things as short as possible doesn’t always mean that readability goes up.</P>


	<P>Of course in usual case Rubyists would go for maximum readability and simplicity, but please don’t spoil the fun of Golf by telling us that we are producing unmaintainable code.</P>


	<P>We’re doing it on purpose after all. ;)</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>