<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0095)redhanded.hobix.com/bits/tellMeTheHashingDangers.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/bits/tellMeTheHashingDangers.html">--><BASE href=".">


<TITLE>RedHanded » Tell Me the Hashing Dangers</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Tell Me the Hashing Dangers
  <SPAN class="entryPermalink"><A href="../bits/tellMeTheHashingDangers.html" title="Permanent link to &ldquo;Tell Me the Hashing Dangers&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../bits" title="List of entries in the &ldquo;bits&rdquo; category">bits</A>
</DIV>

     <DIV class="entryContent"><PRE>   class Symbol
     def hash; to_s.hash; end
   end
</PRE>

	<P>Someone explain why not.</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:00</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    38 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Evan</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:15</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Because one of the points of using a Symbol is that you don’t unnecessarily construct Strings.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>roberthahn</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:21</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I read the title wrong. I thought you wanted someone to tell you the Dashing Hangers… whatever that means…</P>


	<P>Then, to make things worse, i thought by ‘hash’ you meant data-structure w/ key-value pairs</P>


	<P>Thank goodness irb can help me see what you’re talking about!</P>


	<P>But I have no explanation as to why not. I presume that any answer must explain how that number is created in the first place.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Peter Cooper</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:49</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Because Symbol already has a hash method (which returns the same as object_id, granted)?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Gaffers</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Seems like the problem is that “a”.hash == :a.hash but “a” and :a are not necessarily equivalent.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Tim</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:53</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>The current symbol hashing system is crazy and produces an awful distribution but looking up the string and hashing that is pretty expensive. Can we get a better distribution through some magic shuffling like a hash but on a number without having to resort to getting a string for it?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>muro</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:57</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>hm, I can only think of collisions of “a” and :a being certain :-(</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>12:58</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>Evan:</STRONG> Okay.  So let’s assume that this is ported to C and no extra string is made.</P>


	<P><STRONG>Peter Cooper:</STRONG> I’m thinking in terms of HashWithIndifferentAccess.</P>


	<P><STRONG>Gaffers:</STRONG></P>


<PRE> &gt;&gt; a = {'c' =&gt; 1}
 =&gt; {"c"=&gt;1}
 &gt;&gt; b = {'c' =&gt; 1}
 =&gt; {"c"=&gt;1}
 &gt;&gt; a == b
 =&gt; true
 &gt;&gt; a.hash == b.hash
 =&gt; false
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>24yranib</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>13:10</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Creating extra strings… well that could be avoided in the C code possibly adding some table which caches the internal string’s hash value.</P>


	<P>So what this really does it ask whether or not we should use the string hashing algorithm or some symbol id based one (from my  POV ). Do hash collisions between strings and symbols really matter? What other uses are there for the hash value? Is there a better way to solve sub-optimal hashing of symbols?</P>


	<P>Of course, at the end of all this thought, I still would be asking the same question as _why?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>evan</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>13:23</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Nice. Why not as in Why shouldn’t we do it? Or why not as in Why doesn’t it work already.  Need to dump that pesky collision resolver, but Ruby#hash doesn’t get called by [] it seems. DeepInTheC#hash does.</P>


<PRE>&gt;&gt; class Symbol
&gt;&gt;   def hash; puts "hey!"; self.to_s.hash; end
&gt;&gt; end
=&gt; nil
&gt;&gt; h[:big]
=&gt; nil
&gt;&gt; :big.hash
hey!
=&gt; 842031597
</PRE>

	<P>Maybe I’m all off-base.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Kevin Ballard</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>13:54</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Given that Symbols are unique by definition, why can’t the object ID be the hash?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>14:39</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>As noted earlier, using the object ID results in a poor distribution of hashes—but, this isn’t something to address only at <CODE>Symbol</CODE>!</P>


	<P><CODE>Object#hash</CODE> itself needs to be fixed: it should compute a hash of the object ID using some hash function, rather than just passing the object ID on through.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Peter Cooper</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>14:53</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Kevin: I wondered that, but then I realized different architectures (or even machines) might give different answers.. and.. they do. On  OS X I  get :x.hash  180578 .. on Linux I get :x.hash  159938. This could cause problems in inter-machine situations.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>14:55</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Oh, yeah, and not <EM>just</EM> <CODE>Object#hash</CODE> needs to be fixed…</P>


<PRE><CODE>
static int
rb_any_hash(a)
    VALUE a;
{
    VALUE hval;

    switch (TYPE(a)) {
      case T_FIXNUM:
      case T_SYMBOL:
        return (int)a;
        break;

      case T_STRING:
        return rb_str_hash(a);
        break;

      default:
        hval = rb_funcall(a, id_hash, 0);
        if (!FIXNUM_P(hval)) {
            hval = rb_funcall(hval, '%', 1, INT2FIX(536870923));
        }
        return (int)FIX2LONG(hval);
    }
}</CODE></PRE>

	<P>Poorly distributed hashes make baby Knuth cry.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Sebastian Delmont</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>14:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>why not do the opposite?</P>


	<P>class String
  def hash; intern.hash; end
end</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>evan</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>15:06</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I thought _why wanted a HashWithIndifferentAccess that ran closer to the metal. But everyone went off talking about distribution optimizations.</P>


	<P> WHO IS RIGHT .</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>spork</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>15:12</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>it seems like using the object ID would be subject to the same if not more convoluted error as Gaffers mentioned above as in :a and 12412 would hash to the same location.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Kevin Ballard</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>15:22</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>spork: colliding hashes is acceptable, as long as it’s not a frequent occurrence. The rule is equal objects have the same hash, not hash determines equality.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>15:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>evan</STRONG>: I don’t know, once we noticed that <CODE>Object#hash</CODE>, <CODE>Fixnum#hash</CODE>, <CODE>Symbol#hash</CODE>, and <CODE>rb_any_hash</CODE> actually really, <EM>really</EM> suck, then I guess those became a slightly more pressing issue.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>spork</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>17:17</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>thanks for pointing out the error in my train of thought kevin.</P>


	<P>To follow-up I’m not sure why people are saying that there would then be a poor distribution of hash codes?  You are expecting a lot of collisions on :name and ‘name’?  It seems like object id’s would be pretty nice for giving an even distribution of hash codes.  What am I missing?</P>


	<P>1, 2, 3, 4, ... (seem like good hash codes)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Feb 2007</NOBR> at <NOBR>18:58</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>spork</STRONG>: The bucket is selected by <CODE>hash % number_of_buckets</CODE>; if there is any non-randomness in the distribution of hashes at an interval with common factors to the number of buckets, then you will get increased collisions as hashes map are more likely to map to certain buckets.</P>


	<P>Many hash table implementations, Ruby’s included, round their table sizes up to prime numbers in order to minimize this effect, but it can’t be entirely eliminated unless the hashes are random (i.e. they are produced via a good hash function).</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>rogojin</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Feb 2007</NOBR> at <NOBR>07:30</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><B>Why not? Because it won’t work.</B></P>


	<P>If one wanted HashWithIndifferentAccess at the language level, you would also need :a == ‘a’, because a hash is only a bucket, not an identity. So Gaffers is right.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>chris2</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Feb 2007</NOBR> at <NOBR>08:54</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Thanks rogojin for pointing that out.</P>


	<P>And the who makes them eql? will get some slapping from me.</P>


	<P>Symbols are symbols and strings are strings, it’s not that hard, is it?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>John Whitley</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Feb 2007</NOBR> at <NOBR>17:37</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>Sebastian Delmont</STRONG>: Why not the opposite?</P>


	<P><CODE>class String def hash; intern.hash; end end</CODE></P>


	<P>Because this introduces a space leak as a side effect of calling String#hash.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>rcorsaro</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Feb 2007</NOBR> at <NOBR>19:14</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>rogojin: If hashing is the same for both, wouldn’t it make HashWithIndifferentAccess more efficient?  Of course, you would need other code to go along with it.  It might be missing something here, but that’s how I see it.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>rogojin</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>01 Mar 2007</NOBR> at <NOBR>14:36</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>rcorsaro: What do you mean by ‘hashing is the same for both’?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>gabe</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>01 Mar 2007</NOBR> at <NOBR>19:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>gaffers, rogojin:</P>


	<P>two objects that have the same hash code don’t have to be equal.. your just getting a  hash collision and lookup is slower</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>headius</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>02 Mar 2007</NOBR> at <NOBR>04:56</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>If you want symbols to have a better hash algorithm and to also cache them, that’s fine. But don’t make them match strings, because they’re not strings.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Blake</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>02 Mar 2007</NOBR> at <NOBR>09:04</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Why,</P>


	<P>No reason not to , unless you mind the .02% collision rate of String.hash .</P>


	<P>Unless there’s something wrong with this code, Symbol.hash dont collide.</P>


<PRE>&lt;typo:code lang="ruby"&gt;
def random_string
  # http://snippets.dzone.com/posts/show/2111
    str = ''
    (rand(10) + 1).times do
       str &lt;&lt;  (i = Kernel.rand(62); i += ((i &lt; 10) ? 48 : ((i &lt; 36) ? 55 : 61 ))).chr 
    end
    str
end

# String 
string_collisions = 0; symbol_collisions = 0;
string_bucket={}; symbol_bucket = {}; 
1000000.times do 
  str = random_string
  if string_bucket[str.hash] &amp;&amp; string_bucket[str.hash] != str  
    string_collisions += 1; 
    p "string collision at #{str} with #{string_bucket[str.hash]}";
  end
  if symbol_bucket[str.to_sym.hash] &amp;&amp; symbol_bucket[str.to_sym.hash] != str  
    symbol_collisions += 1;
    p "symbol collision at #{str} with #{symbol_bucket[str.to_sym.hash]}"; 
  end
  string_bucket [str.hash] = str
  symbol_bucket[str.to_sym.hash] = str
end

p "String Collisions: #{string_collisions}",  "Symbol Collisions: #{symbol_collisions}" 
p "Combined string and Symbol Collisions: #{(string_bucket.keys &amp;  symbol_bucket.keys).size}" 

(string_bucket.keys &amp;  symbol_bucket.keys).each do |key|
  p "Key #{key} is the same for string #{string_bucket[key]} and symbol #{symbol_bucket[key]}" 
end

&lt;/typo:code&gt;
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>02 Mar 2007</NOBR> at <NOBR>13:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Blake, I should point out that hash collisions are also a function of the size of the hash table.  So you should be using the generated keys modulus 1000000 (or the next prime number up, etc) in this case.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>djur</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>02 Mar 2007</NOBR> at <NOBR>20:13</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>MenTaLguY: Do you have a better implementation of rb_any_hash? Improving performance of large hashes is only going to get more important as time goes on.</P>


Peter Cooper: 
<PRE>$ ruby -e 'puts :x.hash'
205628
$ ruby -e 'puts :x.hash'
205628
$ ruby -e ':y; puts :x.hash'
205788
$ ruby -e ':y; puts :x.hash; File.open("dump.out", "w") {|f| f.write(Marshal.dump(:x)) }'
205788
$ ruby -e 'puts Marshal.load(File.read("dump.out")).hash'
205628
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Carter</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>03 Mar 2007</NOBR> at <NOBR>19:42</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><PRE><CODE>
class symbol
def hash; (x + to_s + x).hash; end
end

# where x is an obscure unicode character
# in many circumstances a bounded memoization
# of this would be an effective optimization

# i'll have a lot of free time in about a week
# i might try to put together a gem or something
</CODE></PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Carter</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>03 Mar 2007</NOBR> at <NOBR>19:43</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><PRE><CODE>
class Symbol
def hash; (x + to_s + x).hash; end
end

# where x is an obscure unicode character
# in many circumstances a bounded memoization
# of this would be an effective optimization

# i'll have a lot of free time in about a week
# i might try to put together a gem or something
</CODE></PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 Mar 2007</NOBR> at <NOBR>11:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Carter, if you’re going to override Symbol#hash, you’d be much,  MUCH  better off simply running Symbol#object_id through a hash function.  But it’s futile anyway, since the hash “computation” for Symbols is hard-coded in rb_any_hash, in C.</P>


	<P>Looking at g_int_hash, however, in glib, I’m noticing that they no longer bother to run ints through a has function anymore (IIRC they did in older versions).  I wonder whether it was an issue of not being able to find a suitable, yet still reasonably efficient, hash function?  That’d kind of surprise me, though…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>teq</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>06 Mar 2007</NOBR> at <NOBR>03:44</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>some hash function algs are here http://www.partow.net/downloads/GeneralHashFunctions_-_Ruby.zip</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Blake</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>06 Mar 2007</NOBR> at <NOBR>09:31</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Thanks MenTaLguY,</P>


	<P>I’m afraid I don’t get it.  where should I  use the generated keys modulus ?</P>


	<P>I was going from this <A href="http://wiki.lensovet.byethost12.com/CS_61b/Homework/hw6">collision probability tutorial</A></P>


	<P>It was an eye opener for me that collisions re acceptable. That finally makes sense to me.</P>


	<P>I didn’t do any performace tests, but it’s possible that Why’s code, with a small percentage of collisions, could be more efficent than the Symbol.hash method that gets no collisions.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>06 Mar 2007</NOBR> at <NOBR>10:26</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><BLOCKQUOTE>
		<P>where should I use the generated keys modulus?</P>
	</BLOCKQUOTE>


	<P>Look at the “mod N” in the collision probability tutorial you linked to.  N is the number of buckets in the hash table, which is determined from the number of <CODE>( key, value )</CODE> pairs stored in it.  Ruby’s implementation in particular rounds the number of buckets up to the next prime (from a list of primes).</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>06 Mar 2007</NOBR> at <NOBR>10:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Surprisingly, having just measured it, it looks like in many practical cases, not messing with int/symbol hashes works pretty well.  I guess that’s the reason behind the present <CODE>g_int_hash</CODE> and <CODE>rb_any_hash</CODE>.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>sporkmonger</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2007</NOBR> at <NOBR>15:50</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>This is so weird, there’s another spork around.  I wonder if I’m allowed to be the evil twin.</P></DIV></DIV>
</DIV>


<DIV class="entry">
<FORM name="userComment" method="post" action="/api/comment/bits/tellMeTheHashingDangers">
  <DIV class="entryAttrib">
     <DIV class="entryAuthor"><INPUT name="sayor" type="textbox" size="15" maxlength="50"></DIV>
     <DIV id="liveTime" class="entryTime"><NOBR>11 Jul 2010</NOBR> at <NOBR>20:46</NOBR></DIV>
  </DIV>
  <DIV class="entryContentOuter"><DIV class="entryContent">
     <INPUT type="hidden" name="timestamp" value="yopYLare1A">
     <TEXTAREA name="consay" rows="6" cols="50"></TEXTAREA>
     <P><INPUT type="button" name="pleasePreview" value="preview" onclick="liveTextilePreview(document.forms[&#39;userComment&#39;].elements[&#39;consay&#39;], &#39;textilePreview&#39;, &#39;/api/preview&#39;)">
        <INPUT type="submit" name="submit" value="&gt;&gt;">
        <SMALL>* do <A href="../javascript:quickRedReference();">fancy stuff</A> in your comment.</SMALL>
     </P>
     <DIV id="textileWrap"><H4>PREVIEW PANE</H4>
     <DIV id="textilePreview"></DIV>
     </DIV>
     </DIV>
  </DIV></FORM></DIV>
  



        </DIV> 

</DIV>



</DIV>





</BODY></HTML>