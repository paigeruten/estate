<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0089)redhanded.hobix.com/bits/aChargedMetatrick.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/bits/aChargedMetatrick.html">--><BASE href=".">


<TITLE>RedHanded » EigenCharges</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">EigenCharges
  <SPAN class="entryPermalink"><A href="../bits/aChargedMetatrick.html" title="Permanent link to &ldquo;EigenCharges&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../bits" title="List of entries in the &ldquo;bits&rdquo; category">bits</A>
</DIV>

     <DIV class="entryContent"><P>A new sleight of syntax for ya:</P>


<PRE> class RubyTalk &lt; Filter
   + to("ruby-talk@ruby-lang.org")
   + cc("ruby-talk@ruby-lang.org")
   - from("common.troll@gifted.net")
 end

 class SelfBlog &lt; Filter
   + to("selfblog@hobix.com")
   + subject("secretpassword")
   def process(msg)
     Blog.add_post(msg)
   end
 end
</PRE>

	<P>Young ones, see if you can figure out how it’s done before I hand you the actual raw sprinkles of meta magic dust.  Specifically: (<EM>1</EM>) <STRONG>where are the rules getting stored?</STRONG> and (<EM>2</EM>) <STRONG>how are the operators actually implemented?</STRONG>  Just have a think before the spoilers.</P>


	<H2>First, the Code</H2>


<PRE> class Filter
   class Rule
     attr_accessor :field, :terms, :action
     def initialize(f, *a)
       @field = f
       @terms = a
     end
     def -@; @action = :reject end
     def +@; @action = :accept end
   end

   class &lt;&lt; self
     attr_accessor :rules
     [:from, :to, :cc, :subject].each do |m|
       define_method(m) do |*a|
         r = Rule.new(m, *a)
         (@rules ||= []) &lt;&lt; r
         r
       end
     end
   end
 end
</PRE>

	<P>To view the rules for mail going into the <CODE>RubyTalk</CODE> mailbox:</P>


<PRE> RubyTalk.rules.each do |r|
     puts "[#{r.action}] if #{r.field} matches `#{r.terms}'" 
 end
</PRE>

	<H2>And, the Answers</H2>


	<P><STRONG>1. Where are the rules getting stored?</STRONG>  The rules are stored in instance variables inside each class.  So, not in a <CODE>RubyTalk</CODE> object.  In the actual <CODE>RubyTalk</CODE> class.  Right next to the methods.</P>


	<P><STRONG>2. How are the operators actually implemented?</STRONG>  By now, you probably can see just fine.  Unary operators on the <CODE>Rule</CODE> class.  The <CODE>to</CODE> and <CODE>from</CODE> class methods create <CODE>Rule</CODE> classes, which then get charged positively and negatively by the operator.</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>04 May 2006</NOBR> at <NOBR>10:53</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    45 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:03</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>That’s beautiful.</P>


	<P>You know, it’s a bit embarassing, but before this I had never learnt what method names went with the unary operators.  I shall have to file this away…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Jon</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:17</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I get this, except for:</P>


	<P>def -@; @action = :reject end</P>


	<P>What does the @ do? As opposed to have just “def -;”</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:27</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>The unary ops are <CODE>-@, +@, ~@, !@</CODE></P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Adam</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:29</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Jon: I believe
 -@
 +@
Are the unary operator method names</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Jon</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:39</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Ah, I see. Thanks.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:41</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>why</STRONG>: awesome, thanks~</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Ezra</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>12:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>It appears that !@ is not definable?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>teebag</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>13:41</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>wait wait..i thought i had it but i lost it. The unary + and – methods are in the Rule class, right?  So how is it possible that you can call them from Filter? (Like in your example at the top.)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>13:45</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>teebag</STRONG>: The unary operators are called on the results of from(), to(), etc. which are Rule objects.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>13:49</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>Ezra</STRONG>: ah, good catch.  Yes, everything to do with truth in Ruby is hard-coded.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>13:50</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>(bit-twiddling is lies.  all of it.)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><H2>Bonus Challenge</H2>


	<P>Get the <CODE>RubyTalk</CODE> one to work like this:</P>


<PRE> class RubyTalk &lt; Filter
   + to | cc("ruby-talk@ruby-lang.org")
 end
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>teebag</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:13</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>oooooooooooooooooo.
gotit.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>zenspider</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:40</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>!@ is not a unary operator. Unfortunately it is pure syntax.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>murphy</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:43</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>excellent, without eval!</P>


	<P>problem is: it produces warnings (<EM>useless use of +@ in void context</EM>.)</P>


	<P>ko1 made a lang with this +@ trick: http://flgr.0×42.net/deobfu/1-negaposi.html</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:46</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I’m sorry.  I got that from <CODE>parse.y</CODE>, which lists the unary operators in <CODE>op_tbl</CODE>.  Which means:</P>


<PRE> &gt;&gt; "!(unary)".intern
 =&gt; :!
 &gt;&gt; "!@".intern
 =&gt; :!
</PRE>

	<P>But which doesn’t actually work:</P>


<PRE> &gt;&gt; true.send("!(unary)")
 NoMethodError: undefined method `!' for true
        from (irb):2:in `send'
        from (irb):2
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>gmosx</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Ooh, nice ;-)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>murphy</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:56</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Did I mention that that x-thing in Textile was a real bad idea?</P>


	<P><A href="../bits/NegaPosi">http://flgr.0×42.net/deobfu/1-negaposi.html</A></P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>murphy</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>14:58</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I guess unary ! is parsed and converted to some rb_negate method. Same to != and !~.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>murphy</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><A href="http://flgr.xn--042-8ja.net/deobfu/1-negaposi.html">NegaPosi</A></P>


	<P>sorry for the spam :( I should really use the Preview. And the Textile Docu.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:12</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><A href="http://flgr.0x42.net/deobfu/1-negaposi.html">NegaPosi?</A></P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:13</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Wait a minute… <CODE>&gt;_&gt;</CODE></P>


	<P>why, are you telling us that <CODE>x.intern.to_s == x</CODE> isn’t an invariant for non-empty strings?</P>


	<P>That sucks—I think almost everybody was under the erroneous impression that it was.  Speaking for myself, I know I am going to have to rewrite some code not to use symbols now…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>It’s true.  In a few cases.</P>


<PRE> &gt;&gt; "+(binary)".intern
 =&gt; :+
 &gt;&gt; "-(binary)".intern
 =&gt; :-
 &gt;&gt; "+(unary)".intern
 =&gt; :+@
 &gt;&gt; "-(unary)".intern
 =&gt; :-@
 &gt;&gt; "!(unary)".intern
 =&gt; :"!" 
 &gt;&gt; "~(unary)".intern
 =&gt; :~
 &gt;&gt; "!@".intern
 =&gt; :"!" 
 &gt;&gt; "~@".intern
 =&gt; :~
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:40</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I guess that’s okay for many things.  My little lisp interpreter’s going to suffer though.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>15:44</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>(I wouldn’t use it personally, but according to the  R5RS  grammar ! and !@ are both valid identifiers.)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>zenspider</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>16:15</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>huh. I knew there were a couple things like that, but I didn’t realize how bad it was. I think they should be invariant as described above, and the parser/eval should be responsible for dispatching correctly, not the other way around.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>FlashHater</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>16:46</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>As I said in my unposted wink, I smell something fishy. Like a Ruby spam filter. Or something of the sort. This is too EigenSpiffy to only be something to throw arround.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>pHiL</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>17:02</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Always wondered about the unary operator def syntax.  Too bad about that !@ not being definable, though.  Was this a yacc limitation or something?  Could it be changed in 1.9?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Kevin Ballard</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>21:28</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Huh. I didn’t know you could use instance variables in a class directly via a meta-class. That’s actually kinda frightening.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Danno</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>21:54</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Wait, is the | operator supposed to make it so that the latter rule’s terms are copied into the former rule or what?</P>


	<P>Yah know, I mean, the syntax is cool and all, but, maybe it’s  TOO  cool, for school, you know?</P>


	<P>As a  DSL , yeah, sure, but it’s… hrmm.</P>


	<P>Well, in any case, I expect _why’s next feat to be shoe-horning the Klingon language into a  DSL  for putting lids on bacon grease tubs.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>22:43</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Oh, come on, Danno.  Just do the exercise.   You’ll learn something neat.  The pipe is an “or”.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 May 2006</NOBR> at <NOBR>23:03</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>pHiL</STRONG>: It’s got nothing to do with yacc at all.</P>


	<P>Ruby’s boolean operations are all hard-coded for efficiency, not implemented via methods.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>zem</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>02:10</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>unariffic!</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>nornagon</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>06:23</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><CODE>
&gt;&gt; :'!(unary)' # =&gt; :"!" 
</CODE>

	<P>caveat emptor!</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Tanner Burson</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>07:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>That is one of the simplest, and most beautiful meta-programming hacks I’ve seen in quite a while.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>10:06</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Matz has just verified that the !@ operator isn’t callable and will likely be removed.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Danno</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>11:04</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>So here’s a start.  If you want to be able to chain a bunch of |’s together, then Rule might need to keep a list of siblings with which it would like to share it’s terms.</P>


<PRE><CODE>
class Filter
  class Rule
    def -@; @action = :reject; self end
    def +@; @action = :accept; self end
    def |(other_rule)
      both_terms = @terms
      both_terms += other_rule.terms
      other_rule.terms = both_terms
      @terms = both_terms
      self
    end
  end
end
</CODE></PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>05 May 2006</NOBR> at <NOBR>11:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>why</STRONG>: Can you also ping him about whether we can eventually avoid having different strings intern to the same symbol?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>07 May 2006</NOBR> at <NOBR>20:20</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>So, can anyone a bit more familiar with Ruby internals tell me the reason strings like ”<INS>” are converted to :</INS> ?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>07 May 2006</NOBR> at <NOBR>22:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Okay, I just can’t get this right. I find any way to make plus signs display at all, unless it’s only broken in the ajax-y preview…
What I meant to ask is why are strings like <CODE>"+(unary)"</CODE> converted to <CODE>:+@</CODE> (COLON  PLUS AT -SIGN)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Dave Burt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>09 May 2006</NOBR> at <NOBR>23:14</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>We want <CODE></CODE></P><CODE><PRE>- to | cc("ruby-talk@ruby-lang.org")</PRE></CODE><P></P>


	<P>to be a shortcut for <CODE></CODE></P><CODE><PRE>- to("ruby-talk@ruby-lang.org")
- cc("ruby-talk@ruby-lang.org")</PRE></CODE><P></P>


	<P>(I’m rejecting ruby-talk mail because Textile makes it hard to use plus.)</P>


Note <CODE>- to | cc(a)</CODE> means <CODE>(-to) | cc(a)</CODE>. That means:
	<OL>
	<LI>the | method is applied last</LI>
		<LI>the left operand has the action to apply (actually, IS the action unless we change Rule#-@ to return self)</LI>
		<LI>the right operand has the terms</LI>
	</OL>


<CODE><PRE> class Filter::Rule
   def -@; @action = :reject; self end
   def +@; @action = :accept; self end
   def |(other)
     @terms |= other.terms
     other.action = action
     [self, other]
   end
 end
</PRE></CODE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>C Erler</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>12 May 2006</NOBR> at <NOBR>10:32</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Though I wouldn’t use it since it’s ugly, here’s my solution to the challenge :</P>


<PRE> class Filter
   class Rule
     attr_accessor :field, :terms, :action
     def initialize(f, *a)
       @field = f
       @terms = a
     end
     def -@; @action = :reject; self end
     def +@; @action = :accept; self end
   end

   class RulePlaceholder
     attr_accessor :fields
     def initialize(f, filter)
       @filter = filter
       @fields = [f]
     end
     def |(other)
       if other.kind_of? RulePlaceholder
         @fields.concat other.fields
       elsif other.kind_of? Rule
         other.action = @action
         @filter.rules.concat @fields.map { |field| rule = Rule.new(field, *other.terms); rule.action = @action; rule }
       else
         :explode_penguin
       end
     end
     def -@; @action = :reject; self end
     def +@; @action = :accept; self end
   end

   class &lt;&lt; self
     attr_accessor :rules
     [:from, :to, :cc, :subject].each do |m|
       define_method(m) do |*a|
         if a.empty?
           RulePlaceholder.new(m, self)
         else
           r = Rule.new(m, *a)
           (@rules ||= []) &lt;&lt; r
           r
         end
       end
     end
   end
  end
 </PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>C Erler</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>12 May 2006</NOBR> at <NOBR>12:09</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I have seen the error of my ways and slapped it around a bit :</P>


<PRE> class Filter
   class Rule
     attr_accessor :field, :terms, :action
     def initialize(f, *a)
       @field = f
       @terms = a unless a.empty?
     end
     def |(other)
       other.action ||= @action
       @terms ||= other.terms
     end
     def -@; @action = :reject; self end
     def +@; @action = :accept; self end
   end

   class &lt;&lt; self
     attr_accessor :rules
     [:from, :to, :cc, :subject].each do |m|
       define_method(m) do |*a|
         r = Rule.new(m, *a)
         (@rules ||= []) &lt;&lt; r
         r
       end
     end
   end
 end
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>C Erler</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>12 May 2006</NOBR> at <NOBR>12:12</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I have seen the post right before mine and slapped me around a bit.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>14 May 2006</NOBR> at <NOBR>22:57</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>No, good work, C Erler.  The thing is: you get it now.  I’m sure Dave and Danno feel better now too.  Accolades for all of you.</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>