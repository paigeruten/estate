<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0108)redhanded.hobix.com/inspect/thinStrandOfSearchAndReplaceRails.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/thinStrandOfSearchAndReplaceRails.html">--><BASE href=".">


<TITLE>RedHanded » Thin Strand of Search-and-Replace Rails</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Thin Strand of Search-and-Replace Rails
  <SPAN class="entryPermalink"><A href="../inspect/thinStrandOfSearchAndReplaceRails.html" title="Permanent link to &ldquo;Thin Strand of Search-and-Replace Rails&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>If you’re playing with Rails and you want to better understand Ruby <STRONG>blocks</STRONG>, as well as <STRONG>method chaining</STRONG>, Matthew Bohnsack has a great one-liner, which boils to:</P>


<PRE>  Article.find_all.each { |a| a.body.gsub! \
    /src="\/(.*.(jpg|gif|png))/, 'src=\"http://bohnsack.com\1';
    a.save }
</PRE>

	<P>More like three or four lines, but still.  He breaks it up, <A href="http://bohnsack.com/2005/08/15/oneliner-with-rails-and-activerecord/">explains each part</A>, with short paragraph-long lessons.  I like how code like the above has the feeling of a <CODE>sed</CODE> recipe, but isn’t utterly cryptic.</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>00:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    11 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>mfp</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>05:06</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>For me, the lack of parentheses in the gsub! call makes this harder to parse.</P>


I prefer to drop parentheses when:
	<UL>
	<LI>there’s no or only one argument</LI>
		<LI>I want to pretend that it’s not a method call (when using some  DSL ).</LI>
	</UL>


I also dislike things like
<PRE>def somemeth bla, blerg, foo = 1, *bar
</PRE>

	<P><IMG src="../images/obake.gif" alt=""></P>


	<P>Anyway this is not a particularly enticing example of method chaining, is it?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Scott</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>05:54</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent">That looks like some ancient AR code ;)  I rather like (newlines inserted to fit in the box):
<PRE><CODE>
Article.find(:all).each {|a| 
  a.update_attribute(:body, a.body.gsub())
}
</CODE></PRE>

Or if you were doing some operation you weren’t sure would be a success:
<PRE><CODE>
Article.find(:all).select {|a| 
  a unless a.update_attribute(:foo, 'bar')
}
</CODE></PRE>
Which would hand you any articles where the update failed.</DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Scott</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>06:04</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Woops, the ‘a unless’ part is not necessary.  I should not reply before I’ve had my coffee :(</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Bohnsack</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>08:44</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Thanks for the linkage and the suggestions  – update_attribute seems the way to go.</P>


	<P>I was just geeked that I got it to work, not really knowing what I was doing.  The statement I created was mostly a result of bouncing on the tab key in irb, picking methods that looked good, looking at their inspect output, and then repeating a few times until everything worked.</P>


	<P>This seems an important part of the reason why Ruby and the Rails framework are so powerful.  Lots of stuff works like you intuitively expect it to.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Neil</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>14:10</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>If someone wants to explain yet another nifty piece of Ruby code: Quicksort by Tony Hoare at www.approximity.com/rubybuch2/node8_main.html . (I still cannot completely make out the data flow in this script, esp. the nested sorting issue, e.g. how &amp; why [-1, -3.4, ...] would become [-3.4, -1, ...])</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>14:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>def quicksort( xs )
   return xs if xs.size &lt;= 1
   m = xs<SUP><A href="../inspect/thinStrandOfSearchAndReplaceRails.html#fn0">0</A></SUP> # Split-Element
   quicksort(xs.select { |i| i &lt; m } ) +
     xs.select { |i| i == m } +
     quicksort(xs.select { |i| i &gt; m } )
end</P>


	<P>line by line:</P>


<PRE><CODE>
  return xs if xs.size &lt;= 1
</CODE>
</PRE>

	<P>If the size is 1 or 0, we just return the array; it’s already sorted</P>


<PRE><CODE>
  m = xs[0]
</CODE>
</PRE>

	<P>Here we choose an arbitrary “pivot” element.  This can be any element of the array.  In this case we choose the first.</P>


<PRE><CODE>
  quicksort(xs.select { |i| i &lt; m } ) +
     xs.select { |i| i == m } +
     quicksort(xs.select{ |i| i &gt; m } )
</CODE>
</PRE>

	<P>This is a little more complicated.  First, let’s figure out what those selects do.  The first one selects all elements less than the pivot.  The second selects all elements equal to the pivot.  The final one selects all elements greater than the pivot.  Let’s modify this and use some temp variables.</P>


<PRE><CODE>
  less = xs.select { |i| i &lt; m }
  equal = xs.select { |i| i == m }
  more = xs.select { |i| i &gt; m }

  quicksort( less ) + 
    equal + 
    quicksort( more ) )
</CODE>
</PRE>

	<P>In other words, we’re returning a list of all the elements less than the pivot, sorted, then all those equal, then all those greater, sorted.  This is classic divide-and-conquer recursion.  Quicksort is applied to ever smaller lists until we use it on lists of one or zero elements, and we hit the terminating condition.</P>


	<P>OK, I’m not sure if that helped at all :)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>14:36</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Oops, messed up the formatting on that first bit.</P>


<PRE><CODE>
def quicksort( xs )
   return xs if xs.size &lt;= 1
   m = xs[0] # Split-Element
   quicksort(xs.select { |i| i &lt; m } ) +
     xs.select { |i| i == m } +
     quicksort(xs.select { |i| i &gt; m } )
end
</CODE>
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Neil</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>17 Aug 2005</NOBR> at <NOBR>14:52</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Wow, thanks Matt for this ultra quick response! Great going!</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Tsela</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>18 Aug 2005</NOBR> at <NOBR>01:23</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Hehe, it’s funny how this definition of quicksort is a direct translation of how one would write it in functional languages like Haskell. It’s one of the strengths of Ruby that it supports all programming styles (structured, object-oriented, functional, you name it) without ever having to resort to ugly hacks :) .</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>moui</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>18 Aug 2005</NOBR> at <NOBR>05:19</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>To get a handle on the data flow you also can insert: puts i &lt; m etc. or just after def quicksort(xs): puts xs.size; print xs; print ”\n”.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Bel</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>19 Aug 2005</NOBR> at <NOBR>01:00</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>The internal sorting of the array of numbers contained in the less and more temp variables is accomplished by the nested quicksort(xs.select…)functions. Each of these functions has the return-if condition but sets its own m=xs(0) pivot element! (The functions can be called nested because they are enclosed in def quicksort(xs)...end)</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>