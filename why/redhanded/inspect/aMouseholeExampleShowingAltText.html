<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0106)redhanded.hobix.com/inspect/aMouseholeExampleShowingAltText.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/aMouseholeExampleShowingAltText.html">--><BASE href=".">


<TITLE>RedHanded » A MouseHole Example: Showing Alt Text</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">A MouseHole Example: Showing Alt Text
  <SPAN class="entryPermalink"><A href="../inspect/aMouseholeExampleShowingAltText.html" title="Permanent link to &ldquo;A MouseHole Example: Showing Alt Text&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>I figured some of you might want to tinker with a simple MouseHole user script, so I translated one of the most basic GreaseMonkey strips: <A href="http://adamv.com/dev/grease/scripts/comicalt.user.js">comicalt.user.js</A> by Adam Vandenberg, which reveals the alt text for a comic strip right below the strip.</P>


	<P>The MouseHole equivalent (userScripts/comicalt.user.rb) looks like so:</P>


<PRE> MouseHole.script do
   # declaration
   name "Comics Alt Text" 
   namespace "http://adamv.com/greases/" 
   description 'Shows the "hover text" for some comics on the page'
   include_match %r!^http://.*achewood\.com/!
   include_match %r!^http://.*qwantz\.com/!
   version "0.2" 

   # instance variables
   @comics = {
     'achewood' =&gt; '//img[starts-with(@src, "/comic.php?date=")]',
     'qwantz'   =&gt; '//img[starts-with(@src, "/comics/")]'
   }

   # the pages flow through here
   rewrite do |req, res|
     whichSite = case req.request_uri.host
                 when /achewood/: "achewood" 
                 when /qwantz/: "qwantz" 
                 end
     return unless whichSite

     comic = document.elements[@comics[whichSite]]
     return unless comic

     if comic.attributes['title']
       div = Element.new 'div'
       div.attributes['className'] = 'msg'
       div.text = "(#{ comic.attributes['title'] })" 
       comic.parent.insert_after comic, div
     end
   end
 end
</PRE>

	<P>In all, very similiar to Greasemonkey.  The declaration has been moved into the code.  The <CODE>include</CODE> and <CODE>exclude</CODE> directives have been replaced with <CODE>include_match</CODE> and <CODE>exclude_match</CODE>, which both take regexps.</P>


	<P>The <CODE>start</CODE> method receives WEBrick’s <A href="http://www.ruby-doc.org/stdlib/libdoc/webrick/rdoc/classes/WEBrick/HTTPRequest.html">HTTPRequest</A> and <A href="http://www.ruby-doc.org/stdlib/libdoc/webrick/rdoc/classes/WEBrick/HTTPResponse.html">HTTPResponse</A> objects.  You can use these to read headers or to add headers.</P>


	<P>The <SPAN class="caps">HTML</SPAN> itself is parsed by MouseHole and stuck in the user script’s <CODE>@document</CODE> instance variable.  Modify the document with <SPAN class="caps">REXML</SPAN> and the altered document will be delivered back to the browser when you’re done.  <SPAN class="caps">REXML</SPAN> is mixed into MouseHole, so you can refer to <CODE>Element</CODE> and <CODE>Document</CODE> without the module name.</P>


<DIV class="update">
 <STRONG>Updated!</STRONG>  For MouseHole version 1.1.  More user script examples available on the wiki at <A href="http://mousehole.rubyforge.org/wiki/wiki.pl?UserScripts">UserScripts</A>.
</DIV></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>08:06</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    13 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>robert</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>08:11</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Excellent. Examples-we-like.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>robert</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>10:20</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Any way to get MouseHole to reload userscripts? I’m trying to tweak and reload, but hitting the cache, like I should.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>10:28</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Reloading will be in the next release.  You have to restart the whole thing presently.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>brian</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>11:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Ugly hack to check mtimes of user scripts and reload (re-eval) them if they’ve changed.  I’m using it for a quick code/test cycle.  Looking forward to a true Ruby hacker’s solution.</P>


	<P>Diff follows inline…</P>


Compare: (&lt;) mouseHole (3586 bytes)
   with: (&gt;) mouseHole.orig (3361 bytes)
<PRE><CODE>
35,37c35
&lt;     @script_mtime = {}
&lt;         Dir['userScripts/*.user.rb'].each do |userb|
&lt;         @script_mtime[userb] = File.stat( userb ).mtime
---
&gt;         Dir['userScripts/*.user.rb'].each do |userb|
62,66d60
&lt;         if File.stat(path).mtime &gt; @script_mtime[path]
&lt;           @script_mtime[path] = File.stat(path).mtime
&lt;           script = eval(File.read(path))
&lt;           @user_scripts[path] = script
&lt;         end
</CODE>
</PRE></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MrCode</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>12:07</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>brian</STRONG>: More or less that is what Wonderland does, though my scripts are different to those in MouseHole. I don’t think there is any way that is better.</P>


	<P>You know _why, I’m not sure I can compete with you on this. Clearly a quick release with basic functionality is better than some slower but more full-featured release. I should have learned my lesson with the original RubyGems (which I was also reluctant to release too early.)</P>


	<P>I will still show Wonderland, but I don’t think it is any more innovative than MouseHole. In fact I’m starting to dislike the design.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>nedric</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>13:56</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>MrCode: I think it’s safe to say that your effort inspired _why’s.  That’s how a community works.  There’s always room for more implementations of an idea!</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MrCode</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>14:08</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>nedric</STRONG>: Well to be honest I got the idea from here, and _why’s original Hoodwink’d implementation really impressed me in how cool it is to “hack the web.” I was just the first out of the gate in trying to implement a Ruby Greasemonkey, but clearly I wasn’t the first to the finish line.</P>


	<P>Hopefully there will be something that other people can learn from Wonderland, and maybe like RubyGems people will just use the name but not my code. At least I’m good at coming up with project names. Maybe I’ll stop coding and go into marketing.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>&lt;(:{</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>14:35</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>MrCode: Perhaps if nothing else the name of yours (WonderLand) could be used instead of MouseHole.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MrCode</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>14:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Don’t worry, Wonderland will be released and MouseHole will seem rodent-infested in comparison (which is what _why wants anyhow, I think.)</P>


	<P>Most of my frustration is with my own code and slow-progress, not _why’s (very effective) attempt at motivation.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>30 Aug 2005</NOBR> at <NOBR>15:07</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>MrCode</STRONG>: that’s the spirit!  I will be quite thrilled should Ryan trump this.  I’m going to continue to introduce features, but I’m sure they could be easily patched into Wonderland or vice versa.  The world is flexible and we can do what we want.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>robert</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>31 Aug 2005</NOBR> at <NOBR>05:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>brian: thank you!</P>


	<P>why: don’t look at this page in opera on a mac, it will make you cry.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>robert</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>31 Aug 2005</NOBR> at <NOBR>05:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>brian: thank you!</P>


	<P>why: don’t look at this page in opera on a mac, it will make you cry.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>robert</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>31 Aug 2005</NOBR> at <NOBR>05:02</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>but only once.</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>