<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0094)redhanded.hobix.com/inspect/theFullyUpturnedBin.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/theFullyUpturnedBin.html">--><BASE href=".">


<TITLE>RedHanded » The Fully Upturned Bin</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">The Fully Upturned Bin
  <SPAN class="entryPermalink"><A href="../inspect/theFullyUpturnedBin.html" title="Permanent link to &ldquo;The Fully Upturned Bin&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>I have something for you.  I’ve just wrapped up a very sobering article on memory management in Ruby which will sure be a slap in the face to all of you raging deviants.  Let’s not let this continue to be a shrouded and ignored issue.</P>


	<P>I won’t say I’ve hit the nail on the head with this essay.  It’s a brutal read: <A href="http://whytheluckystiff.net/articles/theFullyUpturnedBin.html">The Fully Upturned Bin</A>.</P>


	<P>The synopsis is:</P>


	<OL>
	<LI>Quit lying to yourself, you control GC.</LI>
		<LI>Rather than leaving trash and temporary objects everywhere, try to save the pieces and throw them away at once.</LI>
		<LI>Don’t hang on to useless data, isolate its use into a scope.</LI>
		<LI>Use Ruby’s <SPAN class="caps">ALLOC</SPAN>_N in your extensions.</LI>
	</OL>


	<P>Thankyou.  I think we’re all better now.</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>26 Jun 2005</NOBR> at <NOBR>19:02</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    18 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>timsuth</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>26 Jun 2005</NOBR> at <NOBR>22:41</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><CODE>GC_MALLOC_LIMIT</CODE> (~8mb) isn’t just for the first 8 megs.
	<P>Have a look at <CODE>malloc_increase</CODE> and <CODE>malloc_limit</CODE> in gc.c</P>
	<P>It means Ruby will GC whenever you have allocated more than  XXX  since the last GC.</P>
	<P> XXX  starts at 8mb, but changes according to:</P>
<CODE>
malloc_limit += (malloc_increase - malloc_limit) * (double)live / (live plus freed);</CODE>
	<P>(<CODE>live</CODE> is the number of live objects, <CODE>freed</CODE> is the number we will be getting rid of, I think.)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>timsuth</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>26 Jun 2005</NOBR> at <NOBR>22:42</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent">XXX  is <CODE>malloc_limit</CODE> by the way.
<CODE>malloc_increase</CODE> is the amount you have allocated since the last GC.</DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>cilibrar</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>00:21</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Wunderbar!  This is the missing link I have been waiting for for 2 years now. Thanks so  much Why, you really did the right thing, at least this time.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>hgs</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>04:31</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>This provokes 2 questions from me:</P>
	<P>1) If there are all these heaps which Ruby uses for holding objects in groups of 10_000, then  would it be particularly difficult to have Heap as a native type in Ruby?</P>
	<P>2) I’m wondering to what extent allocation comes into speed of deletions from arrays/hashes.  I have on a couple of occasions reasoned that database access, or complicated maths, would be faster if I cached the results.  However, using a bounded Array of Arrays and assoc(), or using a hash with a limited number of keys, it has been slower than not caching at all.  Are there well known ways of doing this effectively that I have missed?</P>
	<P>The Lua book has an interesting take on building long strings out of small ones, which I think only applies when strings are immutable, but it’s interesting nonetheless: 
<A href="http://www.lua.org/pil/11.6.html">11.6 String buffers</A>   which uses a sort of Tower of Hanoi—you can’t put a long string on the end of a shorter one.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>flgr</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>05:32</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>You could try using Symbols which are faster to compare and look up in Hashes than regular Strings. You can convert a String to a Symbol via String#to_sym and there is also a Symbol literal notation :foo or :”foo”—the latter also allows for interpolation.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>08:22</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>timsuth:</STRONG> if people want me to go into that, I will.  My point was that once you rise about eight megs, the allocation limits will change.  “Ruby will begin to watch your allocation needs and resize the limit accordingly.”
 I don’t really understand the logic behind the <CODE>malloc_increase</CODE>
computation, maybe someone can clue me in on it.  Specifically, why is <CODE>live / freed</CODE> important?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Nikolai Weibull</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>10:00</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>You should really go into the fact that allocating a continuous region is a lot more hard on the memory manager than many small regions.</P>
	<P>hgs: you can certainly put a long string on the end of a shorter one.  The algorithm makes sure that they’ll stack properly.</P>
	<P>I’m again going to say that the rope data structure would be really great to have in Ruby, as it encapsulates the behavior of multiple concatenations efficiently.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>10:46</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>hgs:</STRONG> What would you do with a native Heap object if you had one?</P>
	<P><STRONG>flgr:</STRONG> Symbols are also less expensive memory-wise: if the same string values get used multiple times, each unique value is only stored in the underlying table once.</P>
	<P>There are disadvantages, though.</P>
	<P>One thing to be aware of is that (as far as I know), the strings in the underlying table underlying never get freed.  So it’s probably best not to use Symbols for cases where you expect to be encountering a whole lot of unique strings—you’d just grow the table really fast.</P>
	<P>The other thing is that Symbols can’t be used to represent an empty string.</P>
	<P><STRONG>_why:</STRONG> It’s really the whole <CODE>live / ( live + freed )</CODE> ratio that’s relevent—it reflects the percentage of objects which survived the just-completed GC pass.</P>
	<P>Multiplying by it reduces the magnitude of malloc_limit changes during periods of massive freeing (when a smaller percentage of objects have survived).</P>
	<P>This is probably motivated by situations like those where a bunch of objects get reaped in response to (what might be) the first of a slew of new allocations.  Dropping the limit drastically only to have to increase it again could have performance consequences.
 The ratio introduces a little bit of hysteresis.</P>


	<P>Determining whether that is actually helpful is probably the purview of benchmarkers.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>11:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Good points, MenTaL.  The point about symbols is worth educating.  This is exactly what I’m looking for: how we’re unknowingly affecting memory, the decision we’re making by using certain approaches.  We just don’t talk about it because it’s probably too timely—could change in the future.</P>
	<P>My bet is that it won’t for some time. And, when it does, we still need to know what’s going on.</P>
	<P>Okay, I buy the explanation of <CODE>live / (live + freed)</CODE> as a simple hysteresis.  Now, how does this affect the common user?  I think I’m covered by recommending that we free a big pile of objects at once rather than trickling them out.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>11:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>_why:</STRONG> Probably yeah.</P>
	<P>Incidentally, there’s another bit you might want to cover under category #2—closures.</P>
	<P>A closure will hang on to all the variables belonging to the scope in which it is created, including self and all of its instance variables.  This is true whether or not any of those variables are actually used within the closure.</P>
	<P>e.g.</P>
<PRE><CODE>
  require 'weakref'

  def bramf(zoogma)
    lambda {}
  end

  foo = Object::new
  bar = WeakRef::new(foo)

  baz = bramf(zoogma)

  foo = nil
 GC.start
  p bar.weakref_alive? # =&gt; true

  baz = nil
  GC.start
  p bar.weakref_alive? # =&gt; false
</CODE></PRE>
	<P>When hanging onto parameters or local variables would create problems, two options are:</P>
	<P>1. set such variables to nil before taking the closure:</P>
<PRE><CODE>
def bramf(zoogma)
  zoogma = nil
  lambda {}
end
</CODE></PRE><CODE>
	<P>2. define a separate method which actually takes the closure</P>
<PRE>&lt;code&gt;
def bramf(zoogma)
  bramf_closure
end
def bramf_closure
  lambda {}
end
&lt;/code&gt;</PRE>
	<P>Of course, you need to be conscious of holding onto self too.  That may mean using a secondary object in much the same way as the example above uses a secondary method.</P></CODE></DIV><CODE></CODE></DIV><CODE>
</CODE></DIV><CODE>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>11:52</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Actually, never mind a temporary object.  If you don’t need to hold onto self, you can simply do:</P>
	<P><CODE>nil.instance_eval { lambda { ... } }</CODE></P>
	<P>Which will still capture any local variables, but not self or instance variables.</P>
	<P>Incidentally, if you were wondering why Ruby can’t automatically close over only the variables actually used within the body of the closure, this is why:</P>
<PRE><CODE>
def blugh(fraffle)
  lambda {|e| eval e }
end
domzumbo = blugh("ugzort")
...
p domzumbo.call("fraffle") # =&gt; "ugzort" 
</CODE></PRE>
	<P>Bloody string evals…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>14:27</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>MenTaL: brilliant, yes, this all needs to be added.  I should probably expand this essay into a four-pager (overview, marking, sweeping, extensions).</P>
	<P>The “marking” section would contain stuff like the above: what does Ruby hang on to?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>timsuth</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>14:57</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>As far as the “common user” is affected by <CODE>malloc_increase</CODE> and friends, I guess we can just say</P>
	<P>“The GC also runs whenever you have allocated a certain amount since the last GC.”</P>
	<P>The “When Ruby Sweeps” section in the article currently implies that garbage collection is only run when memory runs out, or when it is triggered manually.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>MenTaLguY</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>15:10</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Is there much to be written about sweeping, really?  Maybe finalization…</P>
	<P>Oh, incidentally, if you want to see <EM>true evil</EM> with regard to reference retention, check out continuations… they necessarily retain all the selves and local variables throughout the entire call stack at the moment they are taken.</P>
	<P>Of course unlike string evals (<EM>mutter…</EM>), I happen to be rather fond of continuations.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>15:12</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Thanks, tim.  You’re absolutely right.  I’ve changed the wording of the first GC condition to clear that up.  I’ve also added a sentence describing that the 8 meg limit is tracked by the “internal memory counter”—lingo for <CODE>malloc_limit</CODE>.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>hgs</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>27 Jun 2005</NOBR> at <NOBR>15:57</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Heaps allow O(log n) searching, so I can have a quicker cache.  “Programming Pearls” devotes one “column” (chapter – 14 pages) to them, so they must be good.  Native so everyone has them, and for speed. And they are good for priority queues. And probably a whole bunch of things I’ve not dreamt of.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Jun 2005</NOBR> at <NOBR>07:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>In this case “heap” just means “a big pile-o-memory”, not the data structure.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>hgs</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>28 Jun 2005</NOBR> at <NOBR>10:33</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Blast! :-(</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</CODE></DIV><CODE>



</CODE></DIV><CODE>





</CODE></DIV></BODY></HTML>