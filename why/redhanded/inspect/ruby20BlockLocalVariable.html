<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0099)redhanded.hobix.com/inspect/ruby20BlockLocalVariable.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/ruby20BlockLocalVariable.html">--><BASE href=".">


<TITLE>RedHanded » Ruby 2.0 block local variable</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Ruby 2.0 block local variable
  <SPAN class="entryPermalink"><A href="../inspect/ruby20BlockLocalVariable.html" title="Permanent link to &ldquo;Ruby 2.0 block local variable&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://d.hatena.ne.jp/babie/" title="Visit babie&#39;s homepage">babie</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>Translated from matz blog, <A href="http://www.rubyist.net/~matz/20050309.html#p03">2005-03-09</A></P>


	<BLOCKQUOTE>
		<P>This is a topic I wanna talk about the meeting on yesterday<SUP><A href="../inspect/ruby20BlockLocalVariable.html#fn1">1</A></SUP> but I didn’t because it didn’t warm up so much.</P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>I’ve been thinking about Ruby’s block scope for a long time. I couldn’t single out easily in various ideas. In these days, It’s thought that I find the one hit the spot.</P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>The specification is as follows.
	</P><UL>
	<LI>Block parameters are only local valiables.</LI>
		<LI>The scope of block parameter is block local.</LI>
		<LI><STRONG>If the name of block parameter is overlapped outside local variable, then it’s error.(<A href="http://shugo.net/jit/">Shugo Maeda</A> won.)</STRONG></LI>
		<LI><STRONG>You can set a variable that is enable in the block using syntax like ”; var” after block parameters.</STRONG> </LI>
		<LI>Overlapping of these variables is error.</LI>
		<LI><STRONG>The scope of a variable appears first in the block is block local (according to the current).</STRONG> </LI>
		<LI><STRONG>The reference to the variable in which the scope used in the method has ended is warned.</STRONG></LI>
	</UL><P></P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>Though it’s different that I’ve declared about Ruby 2.0 upto now (especially, part of strong-ed), I seem the compatibility is higher and the usability is not worsend.  Especially, dblack has been opposed applying the method scope in the point of “The scope of a variable appears first” might be pleased.</P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>Now, as a result,</P>
	</BLOCKQUOTE>


<BLOCKQUOTE>
<PRE>3.times {|i; a|
  a = 5
  p [i, a]
}
</PRE>
</BLOCKQUOTE>

	<BLOCKQUOTE>
		<P>is ok.</P>
	</BLOCKQUOTE>


<BLOCKQUOTE>
<PRE>3.times {|i; a=5|
  p [i, a]
}
</PRE>
</BLOCKQUOTE>

	<BLOCKQUOTE>
		<P>A syntax with initializing is more better. But ”|” is the operator might be in an expression. Thus,
	</P><UL>
	<LI>We give it up.</LI>
		<LI>Only primary one(literal, variable, expression bundled by parentheses, etc) be permitted at initialization.</LI>
	</UL><P></P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>It seems to become either.</P>
	</BLOCKQUOTE>


	<BLOCKQUOTE>
		<P>As for the rest, it depends on whether we accept that the below is error or not.</P>
	</BLOCKQUOTE>


<BLOCKQUOTE>
<PRE>3.times {|i; a=2+3|
  p [i, a]
}
</PRE>
</BLOCKQUOTE>

	<P id="fn1"><SUP>1</SUP> Matz organized a mini meeting <A href="http://www.rubyist.net/~matz/20050308.html#p03">Meetup for The Matsue Ruby Meetup Group</A> . Matz belongs among <A href="http://ruby.meetup.com/48/">Matsue Ruby Meetup Group</A> .</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>14 Mar 2005</NOBR> at <NOBR>09:17</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    13 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>chris2</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>14 Mar 2005</NOBR> at <NOBR>10:47</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Does this mean that <CODE>lambda { |@a, @b| }</CODE> is not allowed anymore?</P>


	<P>Also, I think there could appear problems with respect to code-generation when all local variables need to have unique names…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Daniel Berger</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>14 Mar 2005</NOBR> at <NOBR>16:53</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I can understand making a variable local to the block only.  But requiring that it be unique?   ICK ! NO!</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Matt</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>14 Mar 2005</NOBR> at <NOBR>21:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I agree.  I’d much rather they didn’t have to be unique.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Daniel Berger</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>15 Mar 2005</NOBR> at <NOBR>13:34</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Wait a minute.  Is he saying that you <STRONG>must</STRONG> declare new variables as block parameters? Please, no.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Phil</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>15 Mar 2005</NOBR> at <NOBR>17:22</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>sure the current method of declaring ‘shared’ variables to a block outside the block is a bit of a pain (or conversely, it can bite newbies when they use the same variable name in a block thinking it’s local to the block)... however, there have been various proposals for fixing this over the years, but the more proposals I see the more nervous they make me.  I think I’m almost at the point now where I’d just prefer to keep things as they are.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Daniel Berger</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>15 Mar 2005</NOBR> at <NOBR>20:58</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Phil, I have to agree with you.  The changes I wanted are minimal, but I’d gladly leave things where they are rather than implement what Matz is proposing here.  A truly terrible idea  IMHO .</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>matz</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>00:47</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>chris2: first, instance variables will not be allowed in the block parameters.  second, they should be unique, <EM>as they should be now</EM>.</P>


	<P>daniel: you can declare block local variables, but declaration is not mandatory.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>kHebSkik</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>02:51</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent">Maybe someone can explain why taking the view
of a block having its own environment and a reference to the next-outer environment is not
usable, here? Like in scheme:
<PRE> (lambda (x y)
  (set! y 6)
  (lambda (y z)
     (set! y 5)(set! x 7)
     ; the inner y is 5, now and we can refer
     ; to x, which has become 7 and z also
  )
  ; the outer y is still 6, we cannot refer
  ; to z, only to x which is now 7
 )
</PRE>

	<P>I honestly never understood why this is such a big deal in Ruby. But <STRONG>obviously</STRONG> I’m completely
missing the point, here…</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Austin</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>08:08</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Matz, I have to admit that I don’t get it. Let’s say that I’ve got
the following:</P>


<PRE>pdf = PDF::Writer.new

toc = []

  # Place a destination marker at the specified point so that it can be
  # linked to from the actual table of contents entry.
xref = lambda do |info|
  level, label = info[:params].split(/:/o)
  label = CGI.unescape(label)
  page  = pdf.which_page_number(pdf.current_page_number)
  toc &lt;&lt; [ label, page, level ]
  ...
end
</PRE>

	<P>Will my use of <CODE>pdf</CODE> and <CODE>toc</CODE> be illegal,
now? What happens if I had an “info” variable before the definition
of the xref lambda? Do I need to do: <CODE>xref = lambda { |info;
pdf, toc| ... }</CODE>?</P>


	<P>If that’s the case, then I can safely say that I don’t like the
proposal, as it will break existing code—that I just wrote, no
less!—in nasty, nasty, nasty ways.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>matz</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>09:01</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Austine, the code is totally valid.  Don’t worry.</P>


	<P>The points are:</P>


	<UL>
	<LI>block parameters (“info” in the example) must be unique, no shadowing.</LI>
	</UL>


	<UL>
	<LI>if you want to make sure the variables to be block local, place their names after ”;”.  shadowing will be detected as an error.</LI>
	</UL>


	<UL>
	<LI>use of out-of-scope variables will be detected and warned.</LI>
	</UL></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Austin</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>09:55</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent">Okay, to try to make sure I understand this:
<PRE>xref = lambda do |info|
  ...
  page  = pdf.page_number(pdf.current_page)
  ...
end</PRE>
In this, info must not be shadowed, but level, label, page, and toc are leaky?
That is, I could do:
<PRE>xref.call(myinfo)
  puts page # =&gt; gets the page number?</PRE>
To ensure that page wouldn’t be leaky, I need to do |info; page|? Or is it that
page isn’t leaky (as it isn’t now), but the following would works?
<PRE>page = 35
  xref = lambda do |info; page|
     page = 40
     puts page # -&gt; 40
  end
  puts page # -&gt; 35</PRE>
If that’s the way, I can live with that, but I agree with Dan that it would be
useful to see how this might be modeled in the extension form, and the
documentation on this will have to be explicitly clear.</DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Sam</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>15:48</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I’d go for the Scheme-style block parameters as suggested above.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Brian Mitchell</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>16 Mar 2005</NOBR> at <NOBR>16:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I checked the ChangeLog on 1.9. The experimental changes are in:</P>


<PRE>Wed Mar  9 18:09:51 2005  Yukihiro Matsumoto  &lt;matz@ruby-lang.org&gt;

        * parse.y (gettable_gen): warns if VCALL name is used as
          out-of-scope block local variable.  [EXPERIMENTAL]

        * parse.y (opt_bv_decl): add explicit block local variable
          declaration.  raises error for name conflicts.  [EXPERIMENTAL]
</PRE>

	<P>The best way to answer your questions would be to check the latest from  CVS . I have a feeling that the original text was a bit more clear before translation.</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>