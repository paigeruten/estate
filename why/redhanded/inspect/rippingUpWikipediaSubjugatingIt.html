<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0106)redhanded.hobix.com/inspect/rippingUpWikipediaSubjugatingIt.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/rippingUpWikipediaSubjugatingIt.html">--><BASE href=".">


<TITLE>RedHanded » Ripping Up Wikipedia, Subjugating It</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Ripping Up Wikipedia, Subjugating It
  <SPAN class="entryPermalink"><A href="../inspect/rippingUpWikipediaSubjugatingIt.html" title="Permanent link to &ldquo;Ripping Up Wikipedia, Subjugating It&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>There’s an article that covers <A href="http://shanesbrain.net/articles/2006/10/02/screen-scraping-wikipedia">taking apart Wikipedia pages</A> with Hpricot on the blog of Shane Vitarana.  His commenters also point out the <A href="http://en.wikipedia.org/w/query.php">Wikipedia <SPAN class="caps">API</SPAN></A>, which is a fantastic way of getting at the raw data—in <SPAN class="caps">YAML</SPAN> even!  Still, it gives you the raw Wiki text, untransformed.  Hence Hpricot.</P>


	<P>Anyway, I just want to make a couple suggestions for his script.  These aren’t a big deal, just some shortcuts in Hpricot, which aren’t documented yet.  Let’s start getting them known, you know?</P>


	<P>First, a simple one: the Element#attributes hash can be used through Element#[].</P>


<PRE> #change /wiki/ links to point to full wikipedia path
 (content/:a).each do |link|
   unless link['href'].nil?
     if link['href'] =~ %r!^/wiki/!
       link['href'].sub!('/wiki/', 'http://en.wikipedia.org/wiki/')
     end
   end
 end
</PRE>

	<P>In the section where Shane loops through a bunch of <SPAN class="caps">CSS</SPAN> selector and removes everything that matches, I think it’s quicker to join the separate <SPAN class="caps">CSS</SPAN> selectors with commas, to form a large selector which Hpricot can find with a single pass.</P>


<PRE> #remove unnecessary content and edit links
 (content/items_to_remove.join(',')).remove
</PRE>

	<P>And lastly, I’ve <A href="http://code.whytheluckystiff.net/hpricot/changeset/54">checked in</A> a new <CODE>swap</CODE> method in which replaces an element with an <SPAN class="caps">HTML</SPAN> fragment.</P>


<PRE> #replace links to create new entries with plain text
 (content/"a.new").each do |link|
   link.swap(link['title'])
 end
</PRE>

	<P>So, yeah.  Little things.  Hey, are there any other methods you’re itching for?</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>10:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    11 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>DerGuteMoritz</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>10:57</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Why <CODE>swap</CODE> and not <CODE>replace</CODE>? :)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Ola Bini</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>11:03</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Maybe because it’s a whooping 3 bytes larger! =)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Manfred</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>11:12</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Because <CODE>replace</CODE> replaces parts of the contents of a thing and <CODE>swap</CODE> replaces the complete content of something.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>shane</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>11:33</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Thanks for <CODE>swap</CODE> why! I really didn’t like the <CODE>end.remove</CODE> syntax.  I was going to hack <CODE>Elements::before</CODE> but this is much cleaner.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>FlashHater</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>11:35</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>W00t, _why is back in the blogging mood, I am happy. I subjugate the Second Life status page and make it control my  MPD  server durring downtimes.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>11:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I guess I felt like <CODE>replace</CODE> is used to replace an Element obj with an Element obj.  In this case, an Element is getting replace with a String (which is parsed and turned into an Element.)</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>lukfugl</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>13:02</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Regarding <CODE>(content/items_to_remove.join(',')).remove</CODE>, why not <CODE>(content/items_to_remove).remove</CODE>?</P>


	<P>Just define:</P>


<PRE>  def /(selector)
    case selector
    when Array
      self / selector.join(',')
    else
      # the current code
    end
  end
</PRE>

	<P>Of course, condensing and refactoring as necessary.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>appleman</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>17:53</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>One request:</P>


	<P>Ability to figure out the distinct path of an element/text node by calling a method on the node.  That way, you could always get to that node assuming the document itself does not change.  This is opposite of the current approach, where you know the path in advance and use it to get to the data you want.  If you don’t know exactly where your data will be, this will help you find its path and find it again later on.  It would be even better to analyze the node’s path and figure out the most effective and minimal path (whether in xpath or css) to get back to that node…</P>


	<P>Perhaps the ability to figure out how deep you on in a tree and how many siblings you have and where you rank amoung those siblings.</P>


	<P>I believe you can do these things by building a recursive method using the traverse_text method and parent method, but it would be nice if it was captured during the traversal of the tree.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>appleman</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>04 Oct 2006</NOBR> at <NOBR>17:59</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>One request:</P>


	<P>Ability to figure out the distinct path of an element/text node by calling a method on the node.  That way, you could always get to that node assuming the document itself does not change.  This is opposite of the current approach, where you know the path in advance and use it to get to the data you want.  If you don’t know exactly where your data will be, this will help you find its path and find it again later on.  It would be even better to analyze the node’s path and figure out the most effective and minimal path (whether in xpath or css) to get back to that node…</P>


	<P>Perhaps the ability to figure out how deep you on in a tree and how many siblings you have and where you rank amoung those siblings.</P>


	<P>I believe you can do these things by building a recursive method using the traverse_text method and parent method, but it would be nice if it was captured during the traversal of the tree.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>tobinibot</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>10 Oct 2006</NOBR> at <NOBR>08:41</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>What about a way to set http headers, like user-agent?  Or does that already exist, and I’m just missing it?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>shanethepain</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>18 Oct 2006</NOBR> at <NOBR>22:52</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>tobinibot- I don’t remember seeing the user-agent being set in the source.  The  HTML  returned from Wikipedia appends a link to the original article in the Notes section, which is probably due to an unknown user-agent.</P></DIV></DIV>
</DIV>


<DIV class="entry">
<FORM name="userComment" method="post" action="/api/comment/inspect/rippingUpWikipediaSubjugatingIt">
  <DIV class="entryAttrib">
     <DIV class="entryAuthor"><INPUT name="sayor" type="textbox" size="15" maxlength="50"></DIV>
     <DIV id="liveTime" class="entryTime"><NOBR>11 Jul 2010</NOBR> at <NOBR>21:00</NOBR></DIV>
  </DIV>
  <DIV class="entryContentOuter"><DIV class="entryContent">
     <INPUT type="hidden" name="timestamp" value="yopYLare1A">
     <TEXTAREA name="consay" rows="6" cols="50"></TEXTAREA>
     <P><INPUT type="button" name="pleasePreview" value="preview" onclick="liveTextilePreview(document.forms[&#39;userComment&#39;].elements[&#39;consay&#39;], &#39;textilePreview&#39;, &#39;/api/preview&#39;)">
        <INPUT type="submit" name="submit" value="&gt;&gt;">
        <SMALL>* do <A href="../javascript:quickRedReference();">fancy stuff</A> in your comment.</SMALL>
     </P>
     <DIV id="textileWrap"><H4>PREVIEW PANE</H4>
     <DIV id="textilePreview"></DIV>
     </DIV>
     </DIV>
  </DIV></FORM></DIV>
  



        </DIV> 

</DIV>



</DIV>





</BODY></HTML>