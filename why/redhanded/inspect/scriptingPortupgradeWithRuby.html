<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0103)redhanded.hobix.com/inspect/scriptingPortupgradeWithRuby.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<BASE href="http://redhanded.hobix.com.wstub.archive.org/inspect/scriptingPortupgradeWithRuby.html">--><BASE href=".">


<TITLE>RedHanded » Scripting Portupgrade with Ruby</TITLE>
<LINK rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<LINK rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon" />
<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Expires" content="-1">




<STYLE type="text/css">
 @import "../site.css"; 
</STYLE>
</HEAD><BODY>

<DIV id="page">

<DIV id="hoodwinkd">
  <A href="http://hoodwinkd.hobix.com/"><SPAN>hoodwink.d enhanced</SPAN></A>

</DIV>
<DIV id="buttons">
<DL class="tab">
  <DT><A title="Syndicate this Site" href="index.xml">RSS</A></DT>
  <DD><A title="Syndicate this Site" href="index.xml">2.0</A></DD>
</DL>
<DL class="tab xhtml">
  <DT><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">XHTML</A></DT>
  <DD><A title="Validate this Site" href="http://validator.w3.org/check?uri=http://redhanded.hobix.com/">1.0</A></DD>
</DL>
</DIV>
<H1 class="title"><A href="../"><IMG src="../images/redhanded.gif" alt="RedHanded"></A></H1>
<DIV id="banner">
  <DIV class="tagline">sneaking Ruby through the system</DIV>
  <DIV class="nav"><A href="../5.gets/">5.gets</A> | <A href="../bits/">bits</A> | 
    <A href="../inspect/">inspect</A> | <A href="../cult/">the cult</A> | <A href="../-h/">-h</A></DIV>
</DIV>


<DIV id="content">
<DIV id="sidebar">
<P>New to RedHanded? <A href="../-h/pardonAndWelcome.html">About our sections.</A></P>

<DIV class="sidebarBox">
<H2 class="sidebarTitle">Archive</H2>
<UL>

    <LI><A href="../2004/12/">December 2004</A></LI>

    <LI><A href="../2005/01/">January 2005</A></LI>

    <LI><A href="../2005/02/">February 2005</A></LI>

    <LI><A href="../2005/03/">March 2005</A></LI>

    <LI><A href="../2005/04/">April 2005</A></LI>

    <LI><A href="../2005/05/">May 2005</A></LI>

    <LI><A href="../2005/06/">June 2005</A></LI>

    <LI><A href="../2005/07/">July 2005</A></LI>

    <LI><A href="../2005/08/">August 2005</A></LI>

    <LI><A href="../2005/09/">September 2005</A></LI>

    <LI><A href="../2005/10/">October 2005</A></LI>

    <LI><A href="../2005/11/">November 2005</A></LI>

    <LI><A href="../2005/12/">December 2005</A></LI>

    <LI><A href="../2006/01/">January 2006</A></LI>

    <LI><A href="../2006/02/">February 2006</A></LI>

    <LI><A href="../2006/03/">March 2006</A></LI>

    <LI><A href="../2006/04/">April 2006</A></LI>

    <LI><A href="../2006/05/">May 2006</A></LI>

    <LI><A href="../2006/06/">June 2006</A></LI>

    <LI><A href="../2006/07/">July 2006</A></LI>

    <LI><A href="../2006/08/">August 2006</A></LI>

    <LI><A href="../2006/09/">September 2006</A></LI>

    <LI><A href="../2006/10/">October 2006</A></LI>

    <LI><A href="../2006/11/">November 2006</A></LI>

    <LI><A href="../2006/12/">December 2006</A></LI>

    <LI><A href="../2007/01/">January 2007</A></LI>

    <LI><A href="../2007/02/">February 2007</A></LI>

    <LI><A href="../2007/03/">March 2007</A></LI>

    <LI><A href="../2007/04/">April 2007</A></LI>

    <LI><A href="../2007/05/">May 2007</A></LI>

</UL>
</DIV>

<P><A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html"><IMG src="../images/prag-ruby-book.jpg" alt="PickAxe II"></A><BR>
<A href="http://www.pragmaticprogrammer.com/titles/ruby/index.html">Get your copy of <I>Programming Ruby</I>!</A></P>

 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Links</H2>
        <A href="http://technorati.com/tags/ruby">@technorati</A><BR>
<A href="http://del.icio.us/tag/ruby">@del.icio.us</A><BR>
<A href="http://www.flickr.com/photos/tags/ruby">@flickr</A><BR>
<A href="http://www.artima.com/articles/index.jsp?topic=ruby">@artima</A><BR>
<A href="http://blog.caboo.se/">@caboo</A><BR>
<A href="http://www.oreillynet.com/ruby">@oreilly</A><BR>
<A href="http://ruby-lang.org/">ruby</A><BR>
<A href="http://ruby-doc.org/">-&gt; docs</A><BR>
<A href="http://rubyforge.org/">-&gt; wares</A><BR>
<A href="http://rubygarden.org/ruby/">-&gt; wiki</A><BR>
<A href="http://www.sitepoint.com/forums/forumdisplay.php?f=227">-&gt; forum</A><BR>
<A href="http://www.rubyquiz.com/">-&gt; quizzes</A><BR>
<A href="http://planetruby.0x42.net/">-&gt; planet</A><BR>
<A href="http://meme.b9.com/cdates.html?channel=ruby-lang">-&gt; irc</A><BR>
<A href="http://www.rubyweeklynews.org/">rubyweeklynews</A><BR>
<A href="http://weblog.rubyonrails.com/">rails</A><BR>
<A href="http://wiki.rubyonrails.org/">-&gt; wiki</A><BR>
<A href="http://www.planetrubyonrails.org/">-&gt; planet</A><BR>
<A href="http://thesaq.com/rubyonrails/">-&gt; irc</A><BR>
<A href="http://anarchaia.org/">%anarchaia</A><BR>
<A href="http://project.ioni.st/">%projectionist</A><BR>
<A href="http://pugs.blogs.com/">~audreyt</A><BR>
<A href="http://dablog.rubypal.com/">~black</A><BR>
<A href="http://www.jamesbritt.com/">~britt</A><BR>
<A href="http://www.jamisbuck.org/jamis/">~buck</A><BR>
<A href="http://tomcopeland.blogs.com/juniordeveloper/">~copeland</A><BR>
<A href="http://eigenclass.org/">~fernandez</A><BR>
<A href="http://www.chadfowler.com/">~fowler</A><BR>
<A href="http://www.loudthinking.com/">~hansson</A><BR>
<A href="http://blog.segment7.net/">~hodel</A><BR>
<A href="http://slash7.com/">~hoy/7</A><BR>
<A href="http://fhwang.net/">~hwang</A><BR>
<A href="http://blog.leetsoft.com/">~luetke</A><BR>
<A href="http://www.worldlingo.com/wl/translate?wl_lp=JA-en&wl_glossary=gl1&wl_fl=3&wl_rurl=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_url=http%3A%2F%2Fwww.rubyist.net%2F%7Ematz%2F&wl_g_table=-3">~matz</A><BR>
<A href="http://moonbase.rydia.net/">~mental</A><BR>
<A href="http://techno-weenie.net/">~olson</A><BR>
<A href="http://pragprog.com/pragdave">~pragdave</A><BR>
<A href="http://www.livejournal.com/users/premshree/">~premshree</A><BR>
<A href="http://kronavita.de/chris/blog/">~neukirchen</A><BR>
<A href="http://www.robbyonrails.com/">~robby</A><BR>
<A href="http://www.rousette.org.uk/">~rousette</A><BR>
<A href="http://nubyonrails.com/">~topfunky</A><BR>
<A href="http://www.jvoorhis.com/">~voorhis</A><BR>
<A href="http://onestepback.org/">~weirich</A><BR>
<A href="http://blog.zenspider.com/">~zenspider</A><BR>
        </DIV> 
 <DIV class="sidebarBox">
        <H2 class="sidebarTitle">Syndicate</H2>
        <UL>
            <LI><A href="../index.xml">RSS 2.0</A></LI>
        </UL>
        </DIV> 
 <DIV class="sidebarBox">
        <P>Built upon <A href="http://hobix.com/">Hobix</A></P>
        </DIV> 
<IMG src="../images/redhanded-duck.gif" alt="Type the Duck">
<DIV class="email">Got a story for us? <A href="../mailto:redhanded@hobix.com">E-mail it!</A></DIV>
<DIV class="technorati"><P><A href="http://www.technorati.com/profile/whytheluckystiff">Technorati Profile</A>
<A href="http://www.technorati.com/cosmos/search.html?url=http%3A%2F%2Fredhanded.hobix.com"><BR>
<IMG src="../images/bubble_icon.gif" height="20" width="24" alt="Get Conversations about RedHanded &raquo; sneaking Ruby through the system"></A>
</P>
</DIV>

</DIV>


 <DIV id="blog">
        
<DIV class="entry">
    <H2 class="entryTitle">Scripting Portupgrade with Ruby
  <SPAN class="entryPermalink"><A href="../inspect/scriptingPortupgradeWithRuby.html" title="Permanent link to &ldquo;Scripting Portupgrade with Ruby&rdquo;">#</A></SPAN>
</H2>

<DIV class="entrySection">by <A href="http://whytheluckystiff.net/" title="Visit why&#39;s homepage">why</A> 
  in <A href="../inspect" title="List of entries in the &ldquo;inspect&rdquo; category">inspect</A>
</DIV>

     <DIV class="entryContent"><P>I guess it’s hard to top <A href="http://www.rubyx.org/">RubyX</A> when it comes to an OS alliance with Ruby.  However, FreeBSD’s <A href="http://www.onlamp.com/pub/a/bsd/2003/08/28/FreeBSD_Basics.html">portupgrade</A> long ago heaved the bar up—it’s a scriptable application for updating ports.  I’ve always considered it to be neck-and-neck with tDiary for being Ruby’s first killer app.  And portupgrade has got tDiary beat on worldwide adoption.  tDiary is hot snakes in Japan—and only.</P>


	<P>The primary means of scripting portupgrade is with the <CODE>pkgtools.conf</CODE>, which is a Ruby script full of constants.  For example, should you want to give make arguments for certain packages, <CODE>MAKE_ARGS</CODE> is a hash:</P>


<PRE>  MAKE_ARGS = {
    'editors/vim' =&gt; 'NO_GUI=yes WITH_RUBY=yes',
    'shells/scponly' =&gt; 'WITH_SCPONLY_SCP=yes WITH_SCPONLY_GFTP=yes 
       WITH_SCPONLY_WINSCP=yes WITH_SCPONLY_CHROOT=yes',
    'sysutils/gkrellm2' =&gt; 'GKRELLM_SERVER_ONLY=yes'
  }
</PRE>

	<P>If you know Ruby, scripting portupgrade becomes really trivial.  In fact, one of the first Ruby programs I wrote kept the long and winding <SPAN class="caps">PHP</SPAN> make flags I had and abstracted them into a simple array.</P>


	<P>Like so:</P>


<PRE>  PHP_OPTS = %w[bz2 ctype imap MySQL overload pcre
    posix session sockets standard tokenizer xml 
    xmlrpc zlib]
  MAKE_ARGS = {
    'lang/php4' =&gt; "BATCH=yes WITH_APACHE2=yes " +
        PHP_OPTS.collect { |o| "WITH_#{o.upcase}=yes" }.join( ' ' )
  }
</PRE>

	<P>Imagine if you could script your web server in this manner.  See and it seems like the budding courtship between <A href="http://www.lighttpd.net/">lighttpd</A> and Ruby would yield such scripting.  (<EM><STRONG>VHosts in a <SPAN class="caps">YAML</SPAN> file, anyone??</STRONG></EM>)</P>


	<P>The author of portupgrade (and portsdb), <A href="http://akinori.org/">knu</A>, has been the Ruby <SPAN class="caps">CVS</SPAN> chieftain since 2000.  He has been nothing but judicious and kind.  And we’ve all benefited from cvsmailer at one time or another, wouldn’t you say??</P></DIV> 
</DIV>
<DIV class="entryFooter"> 
    <NOBR>18 Mar 2005</NOBR> at <NOBR>17:49</NOBR>
    <NOSCRIPT></NOSCRIPT>
   | 
    4 comments
</DIV>
</DIV>
<DIV id="comments">


<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Eric</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>18 Mar 2005</NOBR> at <NOBR>18:40</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>I don’t know much about lighttpd, but Apache and Ruby already have some tight integration. With mod_ruby dig all into apache’s data structures and you can supply hooks in various stages of handling a request.</P>


	<P>Also on one server I setup I wrote a simple Ruby script to interact with mod_rewrite. This ruby script determines what site is loaded when it is queried on each request. It gets the data from a MySQL database. Much better than a VHosts in  YAML . No need to even reboot apache when I add a new site. I simply add a record to the database and create the directories to store the website.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Csaba</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>19 Mar 2005</NOBR> at <NOBR>02:24</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P>Oh, only if portupgrade could dump the list of options a given port can take (similarly to 
“emerge -pv” of gentoo)...</P>


	<P>Or can it do that?</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>why</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>19 Mar 2005</NOBR> at <NOBR>10:38</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><STRONG>Eric:</STRONG> I’m not fond of configuration trapped in the database.  Doesn’t that mean I have to work through  HTML  forms rather than Vim?  And I can’t keep version control on those configurations.</P>


	<P>Whenever I’ve had wikis, blogs or configuration files stored in a database, I always get seized by pangs of regret.  Maybe if textarea and other controls were friendlier.</P></DIV></DIV>
</DIV>

<DIV class="entry">
    <DIV class="entryAttrib">
        <DIV class="entryAuthor"><H3>Eric</H3></DIV>
        <DIV class="entryTime">said on 
    <NOBR>21 Mar 2005</NOBR> at <NOBR>15:09</NOBR>
    <NOSCRIPT></NOSCRIPT>
  </DIV>
    </DIV>
    <DIV class="entryContentOuter"><DIV class="entryContent"><P><B>why:</B> In the setup I described was for a small webhosting company I did some work for and their goal was to reduce the amount of configuration. They wanted people to be able to fill out a web-form to create an account. The accounts were more thought of as data that the configuration read not the configuration itself.</P>


	<P>Obviously this script could also read from a YAML , XML or any other file instead of a  SQL  database, but a  SQL  database is more efficient for searching (indexes, optmizations, etc) and it can be easily manipulated by many tools. Also it is “versioned” in the fact that the databases were backed up nightly.</P>


	<P>I agree that plain text is more accessible than  SQL  but  SQL  is quite accessible as well. As far as  YAML  goes I still haven’t understood why the Ruby community likes it so much. If I wanted to deal with a system where whitespace meant something I would be programming in Python. :)</P>


	<P>But this is all kind of off-topic. My only point was that Ruby is already fairly integrated with a webserver (apache) with mod_ruby. Even if you didn’t want to go that route you can still do what you mentioned (ruby determined vhosts) with mod_rewrite. The database backend was just an unnecessary detail.</P></DIV></DIV>
</DIV>


  <DIV class="entry">
    <P><SMALL>Comments are closed for this entry.</SMALL></P>
  



        </DIV> 

</DIV>



</DIV>





</DIV></BODY></HTML>